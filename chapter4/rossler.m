% Mackey-Glass com e sem kahan
clear all
clc
close all
format long

x=[0.1000057140259469; 0.10000428889054676; 0.10000578091301135; 0.1000020609823214; 0.10000813321251358];
xk=[0.1000057140259469; 0.10000428889054676; 0.10000578091301135; 0.1000020609823214; 0.10000813321251358];
s=[0.1000057140259469; 0.10000428889054676; 0.10000578091301135; 0.1000020609823214; 0.10000813321251358];
N=6000;
for i=6:N
x(i)=0.1972*10*x(i-1) - 0.104*10*x(i-2) ...
                  + 0.7456e-4*x(i-4)*x(i-2)^3*x(i-1) ...
                  - 0.2053e-4*x(i-5)*x(i-4)^4 ...
                  - 0.285e-4*x(i-5)*x(i-1)^4 ...
                  + 0.2484e-4*x(i-3)^2*x(i-2)^3 ...
                  + 0.1238e-2*x(i-2)*x(i-1)^2 ...
                  + 0.4353e-4*x(i-5)^4 ...
                  + 0.2258e-2*x(i-5)*x(i-2)*x(i-1)^2 ...
                  + 0.3123e-4*x(i-4)^5 ...
                  + 0.7531e-3*x(i-1)^4 ...
                  - 0.2703e-2*x(i-3)^2*x(i-1)^2 ...
                  - 0.7807e-3*x(i-1)^3 ...
                  - 0.7077e-4*x(i-3)^2*x(i-2)^2*x(i-1) ...
                  - 0.3304e-3*x(i-3)*x(i-2)^3 ...
                  - 0.8847e-2*x(i-5)*x(i-1) ...
                  + 0.7631e-2*x(i-4)*x(i-1) ...
                  - 0.3870e-4*x(i-5)^3*x(i-1)^2 ...
                  + 0.4676e-3*x(i-3)^3*x(i-1);
end

for k=6:N
xk=[0.1972*10*s(k-1); - 0.104*10*s(k-2);...
                  + 0.7456e-4*s(k-4)*s(k-2)^3*s(k-1); ...
                  - 0.2053e-4*s(k-5)*s(k-4)^4; ...
                  - 0.285e-4*s(k-5)*s(k-1)^4; ...
                  + 0.2484e-4*s(k-3)^2*s(k-2)^3; ...
                  + 0.1238e-2*s(k-2)*s(k-1)^2; ...
                  + 0.4353e-4*s(k-5)^4; ...
                  + 0.2258e-2*s(k-5)*s(k-2)*s(k-1)^2; ...
                  + 0.3123e-4*s(k-4)^5; ...
                  + 0.7531e-3*s(k-1)^4; ...
                  - 0.2703e-2*s(k-3)^2*s(k-1)^2; ...
                  - 0.7807e-3*s(k-1)^3; ...
                  - 0.7077e-4*s(k-3)^2*s(k-2)^2*s(k-1); ...
                  - 0.3304e-3*s(k-3)*s(k-2)^3; ...
                  - 0.8847e-2*s(k-5)*s(k-1); ...
                  + 0.7631e-2*s(k-4)*s(k-1); ...
                  - 0.3870e-4*s(k-5)^3*s(k-1)^2; ...
                  + 0.4676e-3*s(k-3)^3*s(k-1)];
s(k)=ksum(xk);
end


plot(x,'k')
hold on
plot(s)

filex = fopen('xrossler_normal.txt','w');
fprintf(filex,'%12.15f\n',x);
fclose(filex);

filexk = fopen('xrossler_kahan.txt','w');
fprintf(filexk,'%12.15f\n',s);
fclose(filexk);